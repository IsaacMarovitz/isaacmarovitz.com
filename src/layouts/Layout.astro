---
import "../styles/global.css";

export interface Props {
	title: string;
	snapping: boolean;
}

const { title, snapping } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" class={snapping ? "snap-container sm:scroll-smooth sm:snap-y sm:snap-mandatory" : ""}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width initial-scale=1.0, viewport-fit=cover" />
		<link rel="icon" href="/favicon.png" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css">
		<link rel="me" href="https://social.treehouse.systems/@isaacmarovitz" />
		<link rel="alternate" type="application/rss+xml" title="Isaac Marovitz - Blog" href={new URL("rss.xml", Astro.site)}/>
		<meta name="generator" content={Astro.generator} />
		<meta name="description" content="Hi, I'm Isaac. I'm a developer from London. I code games, apps, and websites." />
		<title>{title}</title>
		<!-- Google tag (gtag.js) -->
		<script type="text/partytown" src="https://www.googletagmanager.com/gtag/js?id=G-PT8W8Z8KDR"></script>
		<script type="text/partytown">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-PT8W8Z8KDR');
		</script>
	</head>
	<body class="max-w-[1300px]" style="margin: 0 auto; float: none;">
		<slot />
	</body>
</html>

<script>
	function updateGradient() {
		const scrollPosition = window.scrollY;
		const windowHeight = window.innerHeight;
		const documentHeight = document.documentElement.scrollHeight;
		const maxScroll = documentHeight - windowHeight;
		const scrollProgress = maxScroll > 0 ? scrollPosition / maxScroll : 0;

		const gradientTotalHeight = windowHeight * 1.5;
		const viewportPositionInGradient = scrollProgress * (gradientTotalHeight - windowHeight);

		const startStop = -(viewportPositionInGradient / windowHeight) * 100;
		const endStop = startStop + (gradientTotalHeight / windowHeight) * 100;

		const gradient = `linear-gradient(to bottom right in oklab, 
			var(--color-violet-800) ${startStop}%, 
			var(--color-fuchsia-800) ${endStop}%)`;

		document.documentElement.style.background = gradient;
		document.documentElement.style.backgroundAttachment = 'fixed';
	}

	let ticking = false;
	function handleScroll() {
		if (!ticking) {
			window.requestAnimationFrame(() => {
				updateGradient();
				ticking = false;
			});
			ticking = true;
		}
	}

	updateGradient();
	window.addEventListener('scroll', handleScroll);
	window.addEventListener('resize', updateGradient);
</script>